(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{390:function(e,t,o){"use strict";o.r(t);var r=o(42),v=Object(r.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"options请求介绍及应对"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#options请求介绍及应对"}},[e._v("#")]),e._v(" Options请求介绍及应对")]),e._v(" "),o("h2",{attrs:{id:"介绍"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍")]),e._v(" "),o("p",[o("code",[e._v("OPTIONS请求")]),e._v("指method为"),o("code",[e._v("OPTIONS")]),e._v("的http请求。"),o("br"),e._v("\n通俗来说：它的作用是用于WEB服务器是否支持某些header，也可以叫做"),o("code",[e._v("预检请求")]),e._v("(顾名思义：提前检测)。"),o("br"),e._v(" "),o("em",[e._v("通俗说法为了快速理解，并不十分精准")])]),e._v(" "),o("p",[o("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/OPTIONS",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN定义"),o("OutboundLink")],1),e._v("：")]),e._v(" "),o("blockquote",[o("p",[e._v("HTTP 的 OPTIONS 方法 用于获取目的资源所支持的通信选项。")])]),e._v(" "),o("h2",{attrs:{id:"options请求负面影响"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#options请求负面影响"}},[e._v("#")]),e._v(" "),o("code",[e._v("OPTIONS请求")]),e._v("负面影响")]),e._v(" "),o("ol",[o("li",[e._v("请求数据会多一次往返的时间消耗，具体消耗多长时间，取决与用户到服务器（端到端）的网络延迟，及服务的响应时长。"),o("br"),e._v("\n通常在50ms~500ms之间。")]),e._v(" "),o("li",[e._v("后端程序员或一些nginx规则经常不处理"),o("code",[e._v("OPTIONS请求")]),e._v("，导致请求返回404，后续请求失败。")])]),e._v(" "),o("h2",{attrs:{id:"浏览器发起options请求的条件"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#浏览器发起options请求的条件"}},[e._v("#")]),e._v(" 浏览器发起"),o("code",[e._v("OPTIONS请求")]),e._v("的条件")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("请求跨域，且2、3满足一个")])]),e._v(" "),o("li",[e._v("请求方法"),o("strong",[e._v("不是")]),e._v("：HEAD、GET、POST")]),e._v(" "),o("li",[e._v("HTTP的头信息"),o("strong",[e._v("超出以下")]),e._v("几种字段：")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("  Accept  \n  Accept-Language  \n  Content-Language  \n  Last-Event-ID  \n  Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain\n")])])]),o("p",[o("em",[e._v("参考： "),o("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("阮一峰：跨域资源共享 CORS 详解"),o("OutboundLink")],1)])]),e._v(" "),o("p",[e._v("大部分前后端程序员碰到"),o("code",[e._v("OPTIONS请求")]),e._v("是浏览器自动发起的。"),o("br"),e._v("\n为什么只有跨域请求浏览器才会自动发起"),o("code",[e._v("OPTIONS请求")]),e._v("？"),o("br"),e._v("\n可以理解为，浏览器默认不同域名的服务器不是由你维护的，"),o("strong",[e._v("保险起见需要预先检查")]),e._v("一下目标域名的服务器是否支持你自定义的header（或其他）")]),e._v(" "),o("h2",{attrs:{id:"如何避免options"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#如何避免options"}},[e._v("#")]),e._v(" 如何避免Options")]),e._v(" "),o("p",[e._v("方法一：配置网关转发规则，避免跨域"),o("br"),e._v("\n方法二：将请求转换"),o("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("简单请求"),o("OutboundLink")],1),e._v("，比如自定义的header通过query参数传递"),o("br"),e._v("\n方法三：如果你不需要读取该请求的返回内容，可设置"),o("code",[e._v("mode: 'no-cors'")]),e._v("，参考"),o("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("Request.mode"),o("OutboundLink")],1)]),e._v(" "),o("blockquote",[o("p",[e._v("no-cors — 保证请求对应的 method 只有 HEAD，GET 或 POST 方法，并且请求的 headers 只能有简单请求头")])]),e._v(" "),o("p",[o("em",[o("code",[e._v("mode: 'no-cors'")]),e._v("会忽略自定义的header")])]),e._v(" "),o("p",[e._v("如果"),o("code",[e._v("OPTIONS请求")]),e._v("无法避免，设置缓存可尽量降低其负面影响，比如缓存一年："),o("code",[e._v("Access-Control-Max-Age: 31536000")]),e._v("，这样后续相同URL的请求就不会发起"),o("code",[e._v("OPTIONS请求")]),e._v("了。"),o("br"),e._v(" "),o("strong",[e._v("注意：缓存是针对URL的，URL一旦变化缓存会失效（比如URL中有时间戳），会重新发起"),o("code",[e._v("OPTIONS请求")])])])])}),[],!1,null,null,null);t.default=v.exports}}]);