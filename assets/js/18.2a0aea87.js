(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{383:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"clojurescript-node-hotreload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clojurescript-node-hotreload"}},[t._v("#")]),t._v(" ClojureScript + node + hotreload")]),t._v(" "),a("p",[a("em",[t._v("假设你已经创建了项目，并安装了shadow-cljs相关依赖，若未完成请参考文档创建项目：https://shadow-cljs.github.io/docs/UsersGuide.html")])]),t._v(" "),a("p",[a("em",[t._v("本文示例采用shadow-cljs打包构建，详细资料参考"),a("a",{attrs:{href:"https://shadow-cljs.github.io/docs/UsersGuide.html#target-node-script",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("文件目录结构")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("|-src\n|  |-demo\n|    |-script.cljs\n|\n|-shadow-cljs.edn\n")])])]),a("p",[a("strong",[t._v("在项目根目录配置文件"),a("code",[t._v("shadow-cljs.edn")])])]),t._v(" "),a("div",{staticClass:"language-clojure extra-class"},[a("pre",{pre:!0,attrs:{class:"language-clojure"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":source-paths")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":builds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":script")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":id")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":script")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":target")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":node-script")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":main")]),t._v("      demo.script/main\n             "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":output-to")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"target/script.js"')]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(";必须配置devtools，才能开启热替换")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":devtools")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":before-load-async")]),t._v(" demo.script/stop\n                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":after-load")]),t._v(" demo.script/start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("src/demo/script.cljs代码")])]),t._v(" "),a("div",{staticClass:"language-clojure extra-class"},[a("pre",{pre:!0,attrs:{class:"language-clojure"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ns")]),t._v(" demo.script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defn")]),t._v(" main "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("prn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("; 如果是web服务应用，参考官方例子，应该在stop中关闭服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defn")]),t._v(" stop "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defn")]),t._v(" start "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[a("strong",[t._v("确保代码stop函数能执行done")])]),t._v(" "),a("li",[t._v("cd 到项目目录，执行"),a("code",[t._v("shadow-cljs watch script")]),t._v("，然后等待安装依赖、编译完成")]),t._v(" "),a("li",[t._v("新开terminal，执行"),a("code",[t._v("node target/script.js")]),t._v("，可以看到控制台输出“hello world”")]),t._v(" "),a("li",[t._v("修改"),a("code",[t._v("src/demo/script.cljs")]),t._v("保存，可以看到terminal有输出“stop”、“hello word”，说明重新执行了"),a("code",[t._v("stop、start函数")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);