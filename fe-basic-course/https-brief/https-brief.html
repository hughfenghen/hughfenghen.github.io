<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS加密原理简介 | 风痕的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="...">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.5bdd650a.js" as="script"><link rel="preload" href="/assets/js/2.f69a5113.js" as="script"><link rel="preload" href="/assets/js/4.46ad5bf7.js" as="script"><link rel="prefetch" href="/assets/js/10.5c2bb7c0.js"><link rel="prefetch" href="/assets/js/11.a9e937f3.js"><link rel="prefetch" href="/assets/js/12.18e1a8d3.js"><link rel="prefetch" href="/assets/js/13.086c173f.js"><link rel="prefetch" href="/assets/js/14.ba45a4c1.js"><link rel="prefetch" href="/assets/js/15.3332d864.js"><link rel="prefetch" href="/assets/js/16.a62b9621.js"><link rel="prefetch" href="/assets/js/17.df315171.js"><link rel="prefetch" href="/assets/js/18.2a0aea87.js"><link rel="prefetch" href="/assets/js/19.723e65fd.js"><link rel="prefetch" href="/assets/js/20.530ad6f9.js"><link rel="prefetch" href="/assets/js/21.3d3402c7.js"><link rel="prefetch" href="/assets/js/22.d9c40d56.js"><link rel="prefetch" href="/assets/js/23.f4ca2db8.js"><link rel="prefetch" href="/assets/js/24.42966d79.js"><link rel="prefetch" href="/assets/js/25.acb12a54.js"><link rel="prefetch" href="/assets/js/26.e42497f5.js"><link rel="prefetch" href="/assets/js/27.2a48814c.js"><link rel="prefetch" href="/assets/js/28.b9a1fa55.js"><link rel="prefetch" href="/assets/js/29.fc3b3ec7.js"><link rel="prefetch" href="/assets/js/3.b1eb6805.js"><link rel="prefetch" href="/assets/js/30.8aa1373a.js"><link rel="prefetch" href="/assets/js/31.064b6ef6.js"><link rel="prefetch" href="/assets/js/32.2d7f9391.js"><link rel="prefetch" href="/assets/js/33.da7b40ae.js"><link rel="prefetch" href="/assets/js/34.48af420a.js"><link rel="prefetch" href="/assets/js/35.b5212b6b.js"><link rel="prefetch" href="/assets/js/36.6e4b1ce2.js"><link rel="prefetch" href="/assets/js/37.7815b84c.js"><link rel="prefetch" href="/assets/js/38.22e0cdb1.js"><link rel="prefetch" href="/assets/js/39.467f0eff.js"><link rel="prefetch" href="/assets/js/5.279f05c1.js"><link rel="prefetch" href="/assets/js/6.9361dec1.js"><link rel="prefetch" href="/assets/js/7.3cafae79.js"><link rel="prefetch" href="/assets/js/8.a2fdc4e3.js"><link rel="prefetch" href="/assets/js/9.fe737b03.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">风痕的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  博客首页
</a></div><div class="nav-item"><a href="https://github.com/hughfenghen/hughfenghen.github.io/issues?q=-label%3AGitalk+" target="_self" rel="" class="nav-link external">
  经验随记
  <!----></a></div><div class="nav-item"><a href="https://github.com/hughfenghen" target="_self" rel="" class="nav-link external">
  风痕的GitHub
  <!----></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  博客首页
</a></div><div class="nav-item"><a href="https://github.com/hughfenghen/hughfenghen.github.io/issues?q=-label%3AGitalk+" target="_self" rel="" class="nav-link external">
  经验随记
  <!----></a></div><div class="nav-item"><a href="https://github.com/hughfenghen" target="_self" rel="" class="nav-link external">
  风痕的GitHub
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端基础课程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-basic-course/js-lang-history-and-basic.html" class="sidebar-link">JS语言历史及基本特性介绍</a></li><li><a href="/fe-basic-course/js-data-process/" class="sidebar-link">JS数据处理</a></li><li><a href="/fe-basic-course/ts-types-system.html" class="sidebar-link">系统化学习 TS 类型系统</a></li><li><a href="/fe-basic-course/js-concurrent.html" class="sidebar-link">JS 多线程并发</a></li><li><a href="/fe-basic-course/https-brief/https-brief.html" aria-current="page" class="active sidebar-link">HTTPS加密原理简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-basic-course/https-brief/https-brief.html#https如何保证传输数据安全？" class="sidebar-link">HTTPS如何保证传输数据安全？</a></li><li class="sidebar-sub-header"><a href="/fe-basic-course/https-brief/https-brief.html#如何确保服务器公钥没有被篡改？" class="sidebar-link">如何确保服务器公钥没有被篡改？</a></li><li class="sidebar-sub-header"><a href="/fe-basic-course/https-brief/https-brief.html#浏览器如何确保颁发机构是否可信？" class="sidebar-link">浏览器如何确保颁发机构是否可信？</a></li><li class="sidebar-sub-header"><a href="/fe-basic-course/https-brief/https-brief.html#如何篡改https协议传输的数据？" class="sidebar-link">如何篡改HTTPS协议传输的数据？</a></li></ul></li><li><a href="/fe-basic-course/options-request.html" class="sidebar-link">Options请求介绍及应对</a></li><li><a href="/fe-basic-course/timer-delay.html" class="sidebar-link">JS 定时器延迟时长细节</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端杂货</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe/vuepress-gitment.html" class="sidebar-link">VuePress 集成第三方评论模块</a></li><li><a href="/fe/canvas-lib/" class="sidebar-link">Mini Canvas Lib 核心交互实现原理</a></li><li><a href="/fe/body-mask-danmaku/" class="sidebar-link">Web 端基于机器学习实现防档（不挡脸）弹幕</a></li><li><a href="/fe/js-perf-detect.html" class="sidebar-link">JS 检测设备性能</a></li><li><a href="/fe/react-hooks/" class="sidebar-link">react hooks的思考</a></li><li><a href="/fe/thinking-miniprogram.html" class="sidebar-link">小程序的思考</a></li><li><a href="/fe/modularization/" class="sidebar-link">前端模块化设计</a></li><li><a href="/fe/vue-directive-track.html" class="sidebar-link">基于vue directive实现声明式埋点方案</a></li><li><a href="/fe/bug1-safari10.html" class="sidebar-link">BUG: Safari10 Cannot declare a let variable twice: 'e'.</a></li><li><a href="/fe/sw-ssr/" class="sidebar-link">同构项目 Service Worker 离线化实践</a></li><li><a href="/fe/run-web-project-in-termux.html" class="sidebar-link">在Termux中运行web项目</a></li><li><a href="/fe/debug-hover-element/" class="sidebar-link">调试鼠标悬浮（hover）元素的css技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>clojure</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/clojure/cljs-node-hotreload.html" class="sidebar-link">ClojureScript + node + hotreload</a></li><li><a href="/clojure/cljs-transient-performance.html" class="sidebar-link">cljs中普通与瞬态数据结构性能对比</a></li><li><a href="/clojure/shadow-cljs-proto-repl.html" class="sidebar-link">shadow-cljs项目 在 proto repl 切换namespace</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>随想</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/think/dao.html" class="sidebar-link">天道</a></li><li><a href="/think/biosphere/" class="sidebar-link">生存空间</a></li><li><a href="/think/book-review.html" class="sidebar-link">书评笔记</a></li><li><a href="/think/qin/" class="sidebar-link">为何是秦灭六国，统一天下</a></li><li><a href="/think/interview.html" class="sidebar-link">技术面试中的“运气”指什么</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https加密原理简介"><a href="#https加密原理简介" class="header-anchor">#</a> HTTPS加密原理简介</h1> <p>https相关的资料已经非常多，本文尽量以最简洁的图文介绍大致原理，不涉及细节。</p> <p><em>本文开始前，读者需要先了解<strong>对称加密</strong>、<strong>非对称加密</strong>、<strong>hash算法</strong>相关知识。</em></p> <h2 id="https如何保证传输数据安全？"><a href="#https如何保证传输数据安全？" class="header-anchor">#</a> HTTPS如何保证传输数据安全？</h2> <ol><li>服务器将<strong>公钥</strong>（非对称加密）发送给客户端</li> <li>客户端生成随机<strong>密钥</strong>（对称加密），通过公钥加密后发送给服务端，这样双方都拥有了对称加密的密钥</li> <li>后续传输的数据是通过密钥加密的<strong>密文</strong>（所以传输的数据是安全的）</li></ol> <p><img src="/assets/img/http-1.36803d78.jpg" alt="https加密过程"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>http协议传输的数据相当于裸奔，数据从服务器到浏览器，经过的任意一个网络节点（代理、wifi、运营商等等）都可以随意篡改用户数据。</p></div> <h2 id="如何确保服务器公钥没有被篡改？"><a href="#如何确保服务器公钥没有被篡改？" class="header-anchor">#</a> 如何确保服务器公钥没有被篡改？</h2> <p>从上一节可以看到，第一步服务器下发公钥给客户端是明文的，所以确保公钥未被篡改至关重要。</p> <p>上一节第一步，服务器下发的证书中主要包含三个元素：服务器公钥、证书颁发机构信息、颁发机构签名。</p> <p><img src="/assets/img/https-3.a0192c71.jpg" alt="签名来历"></p> <p>浏览器可以根据颁发机构信息找到其对应的公钥，然后三步即可验证服务器公钥是否安全：</p> <ol><li>通过颁发机构公钥解密签名，得到服务器公钥的hash值</li> <li>hash服务器公钥，得到其公钥的hash值</li> <li>对比前两步得到的公钥hash值是否相同，如果相同则说明公钥未被篡改</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里我们可以总结得到：证书是否可信（或者说公钥是否安全），需要通过证书颁发者（的公钥）来验证。</p></div> <h2 id="浏览器如何确保颁发机构是否可信？"><a href="#浏览器如何确保颁发机构是否可信？" class="header-anchor">#</a> 浏览器如何确保颁发机构是否可信？</h2> <p>从第二节可以看到，验证服务器公钥安全性的关键在于颁发机构是否可信。</p> <p>证书颁发机构（组织）是一个树状结构，如图：<br> <img src="/assets/img/https-4.abe50b65.png" alt="证书结构"></p> <p>所以说这个问题类似第二个问题，验证颁发机构是否可信（公钥是否安全），需要通过上层的颁发机构来验证。<br>
采用第二步的方式进行递归验证，即可确保所有证书都是安全的。<br> <img src="/assets/img/https-2.19b3d98b.jpg" alt="证书验证过程"></p> <p>递归的终点即根证书，如何验证根证书是否可信呢？<br>
答案是<strong>浏览器内置</strong>的，无条件信任。(浏览器还会信任操作系统的证书)</p> <h2 id="如何篡改https协议传输的数据？"><a href="#如何篡改https协议传输的数据？" class="header-anchor">#</a> 如何篡改HTTPS协议传输的数据？</h2> <p>https经过这么严密的验证过程，还能篡改数据么？  可以的。</p> <p>从第三步可以看到，只要浏览器信任了假根证书，前面的验证步骤都不安全了。<br>
代理工具的根证书被信任后就可以生成假证书返回给浏览器，而不会被浏览器发现。<br>
所以，所有代理工具都必须用户信任其根证书，才能够查看篡改https请求的内容。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe-basic-course/js-concurrent.html" class="prev">
        JS 多线程并发
      </a></span> <span class="next"><a href="/fe-basic-course/options-request.html">
        Options请求介绍及应对
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5bdd650a.js" defer></script><script src="/assets/js/2.f69a5113.js" defer></script><script src="/assets/js/4.46ad5bf7.js" defer></script>
  </body>
</html>
