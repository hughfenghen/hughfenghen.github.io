---
tags:
  - 音视频
  - WebCodecs
  - WebAV
date: 2024-07-09
---

# 纯 Web 实现视频剪辑

## 前言

WebCodecs API 为 Web 平台提供了音视频编解码能力，因此在 Web 平台（网页、Electron）上实现高效、专业的视频剪辑成品成为可能。

<!-- link -->

读者可通过笔者的[系列文章][1]，了解 Webcodecs API 的用法和 Web 音视频基础知识。

## 业务背景 & 方案分析

为了解决主播投稿场景中，需要对直播视频进行简单编辑的诉求，我们需要开发一款轻量视频剪辑产品。
让用户能在线上完成 直播 - 编辑 - 投稿 流程。

<!-- 其他产品 -->
<!-- 分析主流直播平台，剪辑功能 -->

现有的方案关于视频处理的实现

<!-- 现有剪辑技术方案 -->

|        | 云端 | ffmpeg.wasm | webcodecs |
| ------ | ---- | ----------- | --------- |
| 生态   | 优   | 中          | 差        |
| 扩展性 | 中   | 差          | 优        |
| 兼容性 | 优   | 优          | 差        |
| 成本   | 差   | 优          | 优        |
| 性能   | 中   | 差          | 优        |

ffmpeg -i sintel-2048-surround.mp4 -vf "drawtext=text='Test Text':fontcolor=white:fontsize=24:x=(w-text_w)/2:y=(h-text_h)/2" -codec:a copy output.mp4
4:30, 3.3x

<!-- 性能对比 1080P，其他产品 -->

### 优点

- 成本：只需要少量 Web 开发即可完成前端剪辑功能，节省开发成本的同时，降低了技术复杂性 且不需要服务器运行、维护成本
- 扩展性：能轻松与 Canvas、WebAudio 配合，实现自定义功能

### 缺点

WebCodecs 方案的缺点在于生态成熟度、与兼容性。

鉴于前期并不需要丰富的产品功能（如滤镜、动效），且 WebCodecs 非常容易起扩展，实现这些功能也不会太难。
鉴于前期并只需要。。。

综合考虑

## 功能分析

<!-- 产品截图 -->

开发一个剪辑产品，只需要三个步骤

1. 实现素材管理模块
2. 实现画布模块
3. 实现时间轴模块

每个模块下都包含许多小功能，比如封面、预览播放、分割素材，最终都可以拆解成以下基础能力

- 素材加载、解析、存储
- 视频寻帧、遍历帧
- 素材空间、时间属性设置
- 原始图像、音频数据处理

接下来介绍这些基础能力的实现原理，相信认真阅读完的读者，从零实现一个纯 Web 剪辑产品也并非难事。

## 基础能力实现

### 素材加载、解析、存储

### 视频寻帧

### 空间、时间属性设置

### 数据处理

1.  素材加载（粗剪）
2.  封面
3.  缓存
    1. 调整素材位置、缩放、旋转
4.  预览播放
    1. 调整素材时间
5.  缩略图
6.  分割素材

抛却 UI

<!-- 编解码流程图片 -->

拆解功能，映射到能力

## 数据处理流程

## 基础能力

解析文件是第一步，
寻帧是核心

基础能力实现原理

WebAV

方案选择参考 [ffcreator][2] 的总结

> 大多数视频处理通常离不开 FFmpeg 这个库，虽然 FFmpeg 在视频处理方面具有十分强大的功能。 但是在处理精细的动画效果方面 FFmpeg 就显得力不从心，并且它的使用也很不方便，需要开发去拼接大段的命令行参数。

[1]: https://hughfenghen.github.io/tag/WebAV/
[2]: https://tnfe.github.io/FFCreator/#/README?id=原理简介

<!-- 跨平台：支持在 Edge、Chrome 浏览器，以及 Electron 中运行
体积小：约 50kb（MINIFIED + GZIPPED, 未 tree-shaking） -->

<!-- 接下来剪辑产品主要功能是如何实现的， -->

若读者想了解能力 关于基础能力

- 纯 Web 视频剪辑原理
  - 业务背景、方案调研分析
    - 方案对比：服务端方案、浏览器方案
      - 维度：生态成熟度，扩展灵活性，兼容性，开发成本（方案复杂度），运行成本
      - 结合 用户特征（主播）、产品特性（轻量）
  - Web 音视频数据处理流程
    - 视频 - 帧（图像） - 处理（canvas/WebGL） - 新帧 - 视频
    - 音频 - PCM - 处理（WebAudio） - 新 PCM - 音频
  - 基础能力
    - 加载、解析视频
    - 遍历帧、寻帧
    - 设置素材空间、时间属性
    - 图像处理、音频处理
  - 主要功能原理：预览播放、素材管理、时间轴
  - 其他功能原理：贴纸、滤镜、转场、特效
  - 边界 case
